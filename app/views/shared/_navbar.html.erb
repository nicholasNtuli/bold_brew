<header class="sticky top-0 left-0 w-full bg-white shadow-sm z-50">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
  
    <div class="flex items-center space-x-2">
      <%= link_to root_path, class: "flex items-center space-x-2" do %>
        <span class="text-brew-brown text-2xl font-bold font-bebas">Bold Brew</span>
      <% end %>
    </div>

    <nav class="hidden md:flex space-x-6 lg:space-x-8 text-sm font-medium items-center">
      <%= link_to "Home", root_path, class: "text-brew-dark hover:text-brew-brown transition-colors duration-200 #{'rounded-full py-2 px-4 bg-gray-100' if current_page?(root_path)}" %>
      <%= link_to "Shop", products_path, class: "text-brew-dark hover:text-brew-brown transition-colors duration-200 #{'rounded-full py-2 px-4 bg-gray-100' if current_page?(products_path)}" %>
      <%= link_to "About", about_path, class: "text-brew-dark hover:text-brew-brown transition-colors duration-200 #{'rounded-full py-2 px-4 bg-gray-100' if current_page?(about_path)}" %>
      <%= link_to "Contact", contact_path, class: "text-brew-dark hover:text-brew-brown transition-colors duration-200 #{'rounded-full py-2 px-4 bg-gray-100' if current_page?(contact_path)}" %>
      
      <% if user_signed_in? %>
        <% if current_user.orders.any? %>
          <%= link_to "Orders", orders_path, class: "text-brew-dark hover:text-brew-brown transition-colors duration-200 #{'rounded-full py-2 px-4 bg-gray-100' if current_page?(orders_path)}" %>
        <% end %>
        <% if current_user.admin? %>
          <%= link_to "Products", admin_products_path, class: "text-brew-dark hover:text-brew-brown transition-colors duration-200" %>
        <% end %>
      <% end %>
    </nav>
    
    <div class="flex items-center space-x-4">
      <% if user_signed_in? %>
        <span class="hidden md:block text-sm font-medium text-brew-brown"><%= current_user.email.split('@').first %></span>
        <%= button_to "Sign out", destroy_user_session_path, method: :delete, form: { data: { turbo_confirm: "Are you sure you want to sign out?" } }, class: "hidden md:block text-sm font-medium text-brew-dark hover:text-brew-brown transition-colors duration-200" %>
      <% else %>
        <%= link_to "Sign In", new_user_session_path, class: "hidden md:block text-sm font-medium text-brew-dark hover:text-brew-brown transition-colors duration-200" %>
      <% end %>

      <%= link_to cart_path, class: "relative text-brew-dark hover:text-brew-brown transition-colors duration-200 #{'rounded-full py-2 px-4 bg-gray-100' if current_page?(cart_path)}" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.182 1.707.707 1.707H17m0-12a2 2 0 110 4 2 2 0 010-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        <% if current_cart.present? && current_cart.line_items.count > 0 %>
          <span class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-700 transform translate-x-1/2 -translate-y-1/2 bg-brew-brown rounded-full">
            <%= current_cart.line_items.count %>
          </span>
        <% end %>
      <% end %>

      <button id="mobile-menu-button" class="md:hidden p-2 rounded-md text-brew-dark hover:text-brew-brown hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-brew-brown">
          <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
          <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
      </button>
    </div>
  </div>

  <div class="md:hidden hidden" id="mobile-menu">
    <div class="px-2 pt-2 pb-3 space-y-1 text-center">
      <%= link_to "Home", root_path, class: "block px-3 py-2 rounded-md text-base font-medium text-brew-dark hover:bg-gray-100 #{'bg-gray-100' if current_page?(root_path)}" %>
      <%= link_to "Shop", products_path, class: "block px-3 py-2 rounded-md text-base font-medium text-brew-dark hover:bg-gray-100 #{'bg-gray-100' if current_page?(products_path)}" %>
      <%= link_to "About", about_path, class: "block px-3 py-2 rounded-md text-base font-medium text-brew-dark hover:bg-gray-100 #{'bg-gray-100' if current_page?(about_path)}" %>
      <%= link_to "Contact", contact_path, class: "block px-3 py-2 rounded-md text-base font-medium text-brew-dark hover:bg-gray-100 #{'bg-gray-100' if current_page?(contact_path)}" %>
      
      <% if user_signed_in? %>
        <% if current_user.orders.any? %>
          <%= link_to "Orders", orders_path, class: "block px-3 py-2 rounded-md text-base font-medium text-brew-dark hover:bg-gray-100 #{'bg-gray-100' if current_page?(orders_path)}" %>
        <% end %>
        <% if current_user.admin? %>
          <%= link_to "Admin", admin_products_path, class: "block px-3 py-2 rounded-md text-base font-medium text-brew-dark hover:bg-gray-100 #{'bg-gray-100' if current_page?(admin_products_path)}" %>
        <% end %>
        <span class="block px-3 py-2 rounded-md text-base font-medium text-brew-brown"><%= current_user.email.split('@').first %></span>
        <%= button_to "Sign out", destroy_user_session_path, method: :delete, form: { data: { turbo_confirm: "Are you sure you want to sign out?" } }, class: "block px-3 py-2 rounded-md text-base font-medium text-brew-dark hover:bg-gray-100" %>
      <% else %>
        <%= link_to "Sign In", new_user_session_path, class: "block px-3 py-2 rounded-md text-base font-medium text-brew-dark hover:bg-gray-100" %>
      <% end %>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const button = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');
    const openIcon = button.querySelector('svg.block');
    const closeIcon = button.querySelector('svg.hidden');

    button.addEventListener('click', () => {
      menu.classList.toggle('hidden');
      openIcon.classList.toggle('hidden');
      closeIcon.classList.toggle('hidden');
      button.setAttribute('aria-expanded', !menu.classList.contains('hidden'));
    });
  });
</script>