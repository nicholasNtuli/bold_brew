<div class="container-custom py-12 px-4">
  <h1 class="font-bebas text-5xl text-brew-black mb-8">All Products</h1>

  <div class="flex space-x-2 mb-8">
    <%= link_to 'All', products_path, 
          class: "px-4 py-2 rounded-full #{params[:category].blank? ? 'bg-gray-200 text-gray-700' : 'text-black'}" %>

    <% @categories.each do |category| %>
      <%= link_to category.name, products_path(category: category.name),
            class: "px-4 py-2 rounded-full #{params[:category] == category.name ? 'bg-gray-200 text-gray-700' : 'text-black'}" %>
    <% end %>
  </div>

  <% if @products.any? %>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-8">
      <% @products.each do |product| %>
        <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow flex flex-col justify-between">
          <%= link_to product, class: "flex flex-col h-full" do %>
            <% if product.images.attached? %>
              <%= image_tag product.images.first, class: "w-full h-64 object-cover", alt: "No image available" %>
            <% else %>
              <%= image_tag "placeholder.png", class: "w-full h-64 object-cover", alt: "No image available" %>
            <% end %>

            <div class="p-4 flex flex-col h-full">
              <div class="flex-grow">
                <h2 class="text-xl font-bold text-brew-dark mb-2">
                  <%= product.name %>
                </h2>
                <p class="text-neutral-600 mb-4">
                  <% first_sentence = product.description.split('.').first.strip %>
                  <% if first_sentence.present? && product.description.length > first_sentence.length %>
                    <%= first_sentence + "." %>
                  <% else %>
                    <%= product.description %>
                  <% end %>
                </p>
              </div>
              <div class="mt-auto">
                <p class="font-bold text-lg text-brew-brown">
                  <%= number_to_currency(product.price_cents / 100.0) %>
                </p>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-16">
      <% if @category.present? %>
        <%= image_tag('coffee-logo.png', alt: 'Coffee Logo', class: 'mx-auto mb-4', width: '200', height: '200') %>
        <h2 class="text-2xl font-bold text-brew-dark mb-4">
          <%= @category.name %> coming soon!
        </h2>
        <p class="text-neutral-600">We’re brewing up something new in this category. Check back later!</p>
      <% else %>
        <h2 class="text-2xl font-bold text-brew-dark mb-4">No products found.</h2>
        <p class="text-neutral-600">We’re brewing up something new. Please check back later!</p>
      <% end %>
    </div>
  <% end %>
</div>