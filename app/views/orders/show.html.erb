<div class="container-custom py-12 px-4">
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="font-bebas text-5xl text-brew-brown mb-2">Order Details</h1>
            <div class="flex items-center space-x-4">
                <span class="text-lg text-neutral-600">Order #<%= @order.id %></span>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium <%= @order.status_color %>">
                    <%= @order.formatted_status %>
                </span>
            </div>
        </div>
        <div class="flex space-x-3">
            <%= link_to "← Back to Orders", orders_path, class: "text-sm bg-neutral-100 text-neutral-700 font-medium py-2 px-4 rounded-full shadow-sm hover:bg-neutral-200 transition-colors duration-300" %>
            <% if @order.can_be_canceled? %>
                <%= button_to "Cancel Order", cancel_order_path(@order), 
                    method: :patch,
                    data: { turbo_confirm: "Are you sure you want to cancel this order? This action cannot be undone." },
                    class: "text-sm bg-red-100 text-red-700 font-medium py-2 px-4 rounded-full shadow-sm hover:bg-red-200 transition-colors duration-300" %>
            <% end %>
        </div>
    </div>

    <div class="grid lg:grid-cols-3 gap-8">
        <!-- Order Items -->
        <div class="lg:col-span-2">
            <div class="bg-white p-8 rounded-lg shadow-md border border-neutral-200">
                <h2 class="text-2xl font-bold text-brew-dark mb-6">Order Items</h2>
                
                <div class="space-y-6">
                    <% @order.order_items.each do |item| %>
                        <div class="flex items-center space-x-4 pb-6 border-b border-neutral-200 last:border-b-0 last:pb-0">
                            <div class="w-16 h-16 rounded-lg overflow-hidden flex-shrink-0 bg-neutral-100">
                                <% if item.product.images.attached? %>
                                    <%= image_tag item.product.images.first.variant(resize_to_fill: [64, 64]).processed,
                                        class: "w-full h-full object-cover" %>
                                <% else %>
                                    <div class="w-full h-full flex items-center justify-center text-neutral-400 text-xs">
                                        No Image
                                    </div>
                                <% end %>
                            </div>
                            
                            <div class="flex-1 min-w-0">
                                <h3 class="font-semibold text-brew-dark"><%= item.name || item.product.name %></h3>
                                <p class="text-sm text-neutral-600">
                                    <%= item.product.category.name if item.product.category %>
                                </p>
                                <p class="text-sm text-neutral-600 mt-1">
                                    Quantity: <%= item.quantity %> × <%= number_to_currency(item.unit_price_cents / 100.0, unit: 'R') %>
                                </p>
                            </div>
                            
                            <div class="text-right flex-shrink-0">
                                <p class="font-bold text-lg text-brew-dark">
                                    <%= number_to_currency((item.quantity * item.unit_price_cents) / 100.0, unit: 'R') %>
                                </p>
                            </div>
                        </div>
                    <% end %>
                </div>
            </div>
        </div>
        
        <!-- Order Summary & Details -->
        <div class="lg:col-span-1 space-y-6">
            <!-- Order Summary -->
            <div class="bg-white p-6 rounded-lg shadow-md border border-neutral-200">
                <h3 class="text-xl font-bold text-brew-dark mb-4">Order Summary</h3>
                
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-neutral-600">Subtotal (<%= @order.order_items.sum(:quantity) %> items)</span>
                        <span class="font-semibold text-brew-dark">
                            <%= number_to_currency(@order.total_in_currency, unit: 'R') %>
                        </span>
                    </div>
                    
                    <div class="flex justify-between">
                        <span class="text-neutral-600">Shipping</span>
                        <span class="font-semibold text-green-600">Free</span>
                    </div>
                    
                    <div class="flex justify-between">
                        <span class="text-neutral-600">Tax</span>
                        <span class="font-semibold text-neutral-600">Included</span>
                    </div>
                    
                    <hr class="border-neutral-200">
                    
                    <div class="flex justify-between text-lg">
                        <span class="font-bold text-brew-dark">Total</span>
                        <span class="font-bold text-brew-dark">
                            <%= number_to_currency(@order.total_in_currency, unit: 'R') %>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Order Information -->
            <div class="bg-white p-6 rounded-lg shadow-md border border-neutral-200">
                <h3 class="text-xl font-bold text-brew-dark mb-4">Order Information</h3>
                
                <div class="space-y-3 text-sm">
                    <div>
                        <span class="text-neutral-600">Order Date:</span>
                        <p class="font-medium text-brew-dark">
                            <%= @order.created_at.strftime('%B %e, %Y at %I:%M %p') %>
                        </p>
                    </div>
                    
                    <div>
                        <span class="text-neutral-600">Order Status:</span>
                        <p class="font-medium">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= @order.status_color %>">
                                <%= @order.formatted_status %>
                            </span>
                        </p>
                    </div>
                    
                    <% if @order.payment_intent_id %>
                        <div>
                            <span class="text-neutral-600">Payment ID:</span>
                            <p class="font-medium text-brew-dark font-mono text-xs">
                                <%= @order.payment_intent_id %>
                            </p>
                        </div>
                    <% end %>
                </div>
            </div>

            <!-- Order Timeline -->
            <div class="bg-white p-6 rounded-lg shadow-md border border-neutral-200">
                <h3 class="text-xl font-bold text-brew-dark mb-4">Order Timeline</h3>
                
                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-green-500 rounded-full flex-shrink-0"></div>
                        <div>
                            <p class="font-medium text-brew-dark">Order Placed</p>
                            <p class="text-xs text-neutral-600">
                                <%= @order.created_at.strftime('%B %e, %Y at %I:%M %p') %>
                            </p>
                        </div>
                    </div>
                    
                    <% if @order.paid? || @order.shipped? %>
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 bg-green-500 rounded-full flex-shrink-0"></div>
                            <div>
                                <p class="font-medium text-brew-dark">Payment Confirmed</p>
                                <p class="text-xs text-neutral-600">Payment processed successfully</p>
                            </div>
                        </div>
                    <% else %>
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 bg-neutral-300 rounded-full flex-shrink-0"></div>
                            <div>
                                <p class="font-medium text-neutral-400">Payment Pending</p>
                                <p class="text-xs text-neutral-400">Awaiting payment confirmation</p>
                            </div>
                        </div>
                    <% end %>
                    
                    <% if @order.shipped? %>
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 bg-green-500 rounded-full flex-shrink-0"></div>
                            <div>
                                <p class="font-medium text-brew-dark">Order Shipped</p>
                                <p class="text-xs text-neutral-600">Your order is on its way</p>
                            </div>
                        </div>
                    <% elsif @order.paid? %>
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 bg-yellow-500 rounded-full flex-shrink-0"></div>
                            <div>
                                <p class="font-medium text-yellow-700">Preparing for Shipment</p>
                                <p class="text-xs text-neutral-600">Your order is being prepared</p>
                            </div>
                        </div>
                    <% else %>
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 bg-neutral-300 rounded-full flex-shrink-0"></div>
                            <div>
                                <p class="font-medium text-neutral-400">Preparing for Shipment</p>
                                <p class="text-xs text-neutral-400">Pending payment confirmation</p>
                            </div>
                        </div>
                    <% end %>
                    
                    <% if @order.canceled? %>
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 bg-red-500 rounded-full flex-shrink-0"></div>
                            <div>
                                <p class="font-medium text-red-700">Order Cancelled</p>
                                <p class="text-xs text-neutral-600">
                                    <%= @order.updated_at.strftime('%B %e, %Y at %I:%M %p') %>
                                </p>
                            </div>
                        </div>
                    <% end %>
                </div>
            </div>

            <!-- Support Information -->
            <div class="bg-brew-light p-6 rounded-lg">
                <h3 class="text-lg font-bold text-brew-dark mb-3">Need Help?</h3>
                <p class="text-sm text-neutral-700 mb-4">
                    If you have any questions about your order, please don't hesitate to contact us.
                </p>
                <div class="space-y-2 text-sm">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-brew-brown" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        <span class="text-neutral-700">support@boldbrew.com</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-brew-brown" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                        <span class="text-neutral-700">+27 123 456 789</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>