<div class="container-custom py-12 px-4">
  <div class="flex items-center justify-between mb-8">
    <div class="flex space-x-2">
      <%= link_to 'All', products_path, 
            class: "px-4 py-2 rounded-full #{params[:category].blank? ? 'bg-brew-light text-brew-black' : 'bg-transparent text-brew-dark hover:bg-brew-light transition-colors duration-300'}" %>
      <% @categories.each do |category| %>
        <%= link_to category.name, products_path(category: category.name),
              class: "px-4 py-2 rounded-full #{params[:category] == category.name ? 'bg-brew-light text-brew-black' : 'bg-transparent text-brew-dark hover:bg-brew-light transition-colors duration-300'}" %>
      <% end %>
    </div>
    
    <div class="relative">
      <button id="sort-menu-btn" class="flex items-center px-4 py-2 border rounded-full text-brew-black hover:bg-neutral-100 transition-colors">
        Sort by
        <svg class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
        </svg>
      </button>

      <div id="sort-menu" class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg hidden z-10">
        <div class="py-1">
          <%= link_to 'Newest', products_path(request.query_parameters.merge(q: { s: 'created_at desc' })), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
          <%= link_to 'Name (A-Z)', products_path(request.query_parameters.merge(q: { s: 'name asc' })), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
          <%= link_to 'Price (Low to High)', products_path(request.query_parameters.merge(q: { s: 'price_cents asc' })), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
          <%= link_to 'Price (High to Low)', products_path(request.query_parameters.merge(q: { s: 'price_cents desc' })), class: "block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" %>
        </div>
      </div>
    </div>
  </div>

  <% if @products.any? %>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-8">
      <%= render partial: 'product_card', collection: @products, as: :product %>
    </div>
  <% else %>
    <div class="text-center py-16">
      <% if @category.present? %>
        <%= image_tag('coffee-logo.png', alt: 'Coffee Logo', class: 'mx-auto mb-4', width: '200', height: '200') %>
        <h2 class="text-2xl font-bold text-brew-black mb-4">
          <%= @category.name %> coming soon!
        </h2>
        <p class="text-neutral-600">We’re brewing up something new in this category. Check back later!</p>
      <% else %>
        <h2 class="text-2xl font-bold text-brew-black mb-4">No products found.</h2>
        <p class="text-neutral-600">We’re brewing up something new. Please check back later!</p>
      <% end %>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const sortBtn = document.getElementById('sort-menu-btn');
    const sortMenu = document.getElementById('sort-menu');

    sortBtn.addEventListener('click', (event) => {
      event.stopPropagation();
      sortMenu.classList.toggle('hidden');
    });

    document.addEventListener('click', (event) => {
      if (!sortMenu.contains(event.target) && !sortBtn.contains(event.target)) {
        sortMenu.classList.add('hidden');
      }
    });
  });
</script>